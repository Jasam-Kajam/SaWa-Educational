<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wafula Educational Posts</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>ðŸ“š Wafula Educational Posts</h1>
    <p>Access free learning materials. Pay 50 KES to download any PDF.</p>
  </header>  <main>
    <section id="materials-section">
      <h2>Available Materials</h2>
      <div id="materials-list">Loading...</div>
    </section>
  </main>  <footer>
    <p>&copy; 2025 Wafula Educational Posts</p>
  </footer>  <script>
    const API_URL = 'https://<your-backend-on-render>.onrender.com';

    async function fetchMaterials() {
      try {
        const res = await fetch(`${API_URL}/materials`);
        const data = await res.json();

        const list = document.getElementById('materials-list');
        list.innerHTML = '';

        data.forEach(item => {
          const card = document.createElement('div');
          card.className = 'material-card';
          card.innerHTML = `
            <h3>${item.title}</h3>
            <p>Category: ${item.category}</p>
            <p>Type: ${item.fileType}</p>
            <button onclick="payToDownload('${item.id}')">Pay & Download</button>
          `;
          list.appendChild(card);
        });
      } catch (err) {
        document.getElementById('materials-list').textContent = 'Failed to load materials.';
      }
    }

    function payToDownload(materialId) {
      const handler = PaystackPop.setup({
        key: 'pk_live_3b95d82d975d8cd88f2e0059b1d6dca62c1db036',
        email: 'user@example.com',
        amount: 5000, // KES 50 = 5000 kobo
        callback: function (response) {
          verifyPayment(response.reference, materialId);
        },
        onClose: function () {
          alert('Payment cancelled');
        }
      });
      handler.openIframe();
    }

    async function verifyPayment(reference, materialId) {
      const res = await fetch(`${API_URL}/verify-payment`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ reference, materialId })
      });
      const result = await res.json();

      if (result.downloadUrl) {
        window.open(result.downloadUrl, '_blank');
      } else {
        alert('Payment failed. Try again.');
      }
    }

    fetchMaterials();
  </script>  <script src="https://js.paystack.co/v1/inline.js"></script></body>
</html>