<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wafula Educational Posts</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://js.paystack.co/inline.js"></script>
</head>
<body>
    <header>
        <h1>ðŸ“š Wafula Educational Posts</h1>
    </header>

    <section>
        <h2>Materials</h2>
        <div id="materials-container">
            <!-- Materials will be dynamically loaded here -->
        </div>
    </section>

    <section id="payment-section" style="display: none;">
        <h3>Complete Payment</h3>
        <button id="pay-button" onclick="startPayment()">Pay 50 KES</button>
    </section>

    <script>
        const materialsContainer = document.getElementById('materials-container');
        const payButton = document.getElementById('pay-button');
        let selectedMaterialId = null;

        // Fetch materials from backend
        async function fetchMaterials() {
            try {
                const response = await fetch('https://sawa-educational-backend.onrender.com/materials');
                const materials = await response.json();

                materialsContainer.innerHTML = materials.map(material => `
                    <div class="material-card" data-id="${material.id}">
                        <h3>${material.title}</h3>
                        <p>${material.category}</p>
                        <button onclick="selectMaterial('${material.id}')">Download</button>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Error fetching materials:', err);
                materialsContainer.innerHTML = 'Failed to load materials';
            }
        }

        // Select material for payment
        function selectMaterial(id) {
            selectedMaterialId = id;
            document.getElementById('payment-section').style.display = 'block';
        }

        // Start Paystack payment
        async function startPayment() {
            if (!selectedMaterialId) {
                alert('No material selected.');
                return;
            }

            try {
                const response = await fetch('https://api.paystack.co/transaction/initialize', {
                    method: 'POST',
                    headers: {
                        Authorization: `Bearer YOUR_PAYSTACK_SECRET_KEY`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'customer@example.com',
                        amount: 5000, // 50 KES = 5000 Kobo
                        currency: 'KES',
                        callback_url: window.location.href,
                    }),
                });

                const paymentData = await response.json();

                if (paymentData.status === 'success') {
                    const paymentUrl = paymentData.data.authorization_url;
                    window.location.href = paymentUrl;
                }
            } catch (error) {
                console.error('Payment failed:', error);
                alert('Payment initiation failed.');
            }
        }

        // Load materials on page load
        window.onload = fetchMaterials;
    </script>

    <footer>
        <p>Wafula Educational Posts Â© 2025</p>
    </footer>
</body>
</html>